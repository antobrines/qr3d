server {
    listen 80;
    server_name _;

    client_max_body_size 10M;

    # 1. Interface Web (Flask rend le template index.html)
    location / {
        proxy_pass http://qr-3d-backend:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 2. Servir les fichiers STL directement depuis le volume partagé
    # C'est beaucoup plus performant que de passer par Flask
    location /download_stl/ {
        alias /tmp/qr_3d/;
        add_header Content-Disposition 'attachment';
        # Optionnel : empêcher l'exécution de scripts dans ce dossier
        expires 1h;
    }
}